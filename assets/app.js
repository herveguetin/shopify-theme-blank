window.formatPrice=function(e,t,i){return parseFloat(e).toLocaleString(t,{style:"currency",currency:i,minimumFractionDigits:2,maximumFractionDigits:2})};document.addEventListener("alpine:init",()=>{Alpine.data("addToCart",(e={},t={})=>({product:e,boxConfig:t,isLoading:!1,addProductToCart(){this.isLoading=!0,fetch(window.Shopify.routes.root+"cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:[{id:this.product.variants[0].id,quantity:1,properties:{_box:JSON.stringify(this.boxConfig),_timestamp:this.$store.cart.timestamp(this.product)}}]})}).then(i=>i.json()).then(i=>{this.isLoading=!1;const s=i.items[0];this.$dispatch("cart-item-added",{item:s}),this.$store.cart.fetchCart()})}})),Alpine.data("miniCart",()=>({isOpen:!1,get products(){return this.$store.cart.itemLines},get total(){return this.$store.cart.cart.total_price/100},get itemsCount(){return this.products.reduce((e,t)=>e+t.quantity,0)},quantityLabel(e){let t=e.quantity+" bouteille(s)";if(e.properties._box_data){const i=e.properties._box_data;let s=[];i.nb_of_boxes>0&&s.push(i.nb_of_boxes+" caisse(s)"),i.nb_of_remaining_bottles>0&&s.push(i.nb_of_remaining_bottles+" bouteille(s)"),t=s.join(" + ")}return t},remove(e){const t=e.variant_id,i={};i[t]=0,fetch(window.Shopify.routes.root+"cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({updates:i})}).then(s=>this.$store.cart.fetchCart())}})),Alpine.data("topSearch",()=>({isOpen:!1,q:"",results:{},canShowNoResults:!1,get products(){return this.results.resources?this.results.resources.results.products:[]},open(){this.reset(),this.isOpen=!0},reset(){this.q="",this.results={},this.canShowNoResults=!1},query(){this.q.length>3&&(this.canShowNoResults=!1,fetch(window.Shopify.routes.root+"search/suggest.json?q="+this.q).then(t=>t.json()).then(t=>{this.results=t,this.canShowNoResults=!0}))}})),Alpine.data("carousel",()=>({init(){new Swiper(this.$el,{navigation:{nextEl:this.$refs.btn_next,prevEl:this.$refs.btn_prev},slidesPerView:4,spaceBetween:20})}})),Alpine.data("collection",e=>({collectionId:e,products:[],init(){const t=this;(function(i,s){s=i.createElement("script"),s.type="text/javascript",s.async=!0,s.onload=function(){t.search()},s.src="https://cdn.jsdelivr.net/npm/algoliasearch@4.20.0/dist/algoliasearch.umd.js",i.getElementsByTagName("head")[0].appendChild(s)})(document)},search(){algoliasearch("M61UXZM0A8","4d9f7d038f7fdbfdbf5528bacf6bda0c").initIndex("jbclair_products").search("",{filters:"collections:"+this.collectionId}).then(({hits:s})=>{this.products=s})}})),Alpine.store("cart",{itemLines:Alpine.$persist([]).as("cart_lines"),cart:{},init(){this.fetchCart()},fetchCart(){fetch(window.Shopify.routes.root+"cart.js").then(e=>e.json()).then(e=>{fetch("/apps/second-app/cart/",{method:"POST",headers:{"ngrok-skip-browser-warning":"true","Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{this.cart=t,this.itemLines=t.items})})},removeItemLine(e){this.itemLines=this.itemLines.filter(t=>t.variant_id!==e.variant_id)},timestamp(e){const t=this.itemLines.find(i=>i.id===e.variants[0].id);return t!==void 0?t.properties._timestamp:Date.now()}})});
